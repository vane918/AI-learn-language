<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®ä¼ é€’è°ƒè¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .result {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        button {
            background: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #005a87;
        }
    </style>
</head>
<body>
    <h1>æ•°æ®ä¼ é€’è°ƒè¯•é¡µé¢</h1>
    
    <div class="test-section">
        <h2>æµ‹è¯•1: æ¨¡æ‹ŸAIè¿”å›çš„JSONå­—ç¬¦ä¸²</h2>
        <button onclick="testJsonString()">æµ‹è¯•JSONå­—ç¬¦ä¸²å¤„ç†</button>
        <div id="result1" class="result"></div>
    </div>

    <div class="test-section">
        <h2>æµ‹è¯•2: æ¨¡æ‹ŸhandleTranslationCompleteå‡½æ•°</h2>
        <button onclick="testHandleTranslationComplete()">æµ‹è¯•æ•°æ®å¤„ç†</button>
        <div id="result2" class="result"></div>
    </div>

    <div class="test-section">
        <h2>æµ‹è¯•3: å®é™…ç¿»è¯‘æµ‹è¯•</h2>
        <p>è¯·é€‰æ‹©è¿™ä¸ªå•è¯è¿›è¡Œç¿»è¯‘æµ‹è¯•: <strong>eloquent</strong></p>
        <div id="result3" class="result">è¯·é€‰æ‹©ä¸Šé¢çš„å•è¯ï¼Œç„¶åæŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„è°ƒè¯•ä¿¡æ¯</div>
    </div>

    <script>
        function testJsonString() {
            const jsonString = `{
                "translation": "é›„è¾©çš„",
                "wordType": "å½¢å®¹è¯",
                "pronunciation": "/ËˆelÉ™kwÉ™nt/",
                "explanation": "å¤„ç†è¦ç‚¹:\\n1. æ ¸å¿ƒè¯­ä¹‰ä¸º'è¡¨è¾¾æœ‰åŠ›çš„'ï¼Œä¸­æ–‡é€‰ç”¨'é›„è¾©'å¯¹åº”å…¶ä¿®è¾å­¦å†…æ¶µ\\n2. -entå½¢å®¹è¯åç¼€ç»Ÿä¸€å¤„ç†ä¸º'çš„'",
                "examples": [
                    "è¿™ä½å¾‹å¸ˆçš„æ€»ç»“é™ˆè¯ååˆ†é›„è¾© (The lawyer's closing argument was remarkably eloquent) - å±•ç¤ºæ ‡å‡†ç”¨æ³•",
                    "å°½ç®¡ä¸å–„è¨€è¾ï¼Œä»–çš„æ–‡å­—å´å¼‚å¸¸é›„è¾© (Though soft-spoken, his writings were extraordinarily eloquent) - å˜æ¢ç‚¹ï¼šä¿®é¥°å¯¹è±¡è½¬æ¢"
                ]
            }`;
            
            console.log('åŸå§‹JSONå­—ç¬¦ä¸²:', jsonString);
            console.log('å­—ç¬¦ä¸²ç±»å‹:', typeof jsonString);
            
            try {
                const parsed = JSON.parse(jsonString);
                console.log('è§£æåçš„å¯¹è±¡:', parsed);
                console.log('å¯¹è±¡ç±»å‹:', typeof parsed);
                
                document.getElementById('result1').innerHTML = `
                    <strong>åŸå§‹å­—ç¬¦ä¸²:</strong><br>
                    <pre>${jsonString}</pre>
                    <strong>è§£æåçš„å¯¹è±¡:</strong><br>
                    <pre>${JSON.stringify(parsed, null, 2)}</pre>
                `;
            } catch (error) {
                console.error('JSONè§£æé”™è¯¯:', error);
                document.getElementById('result1').innerHTML = `JSONè§£æé”™è¯¯: ${error.message}`;
            }
        }

        function testHandleTranslationComplete() {
            // æ¨¡æ‹ŸhandleTranslationCompleteå‡½æ•°çš„é€»è¾‘
            function mockHandleTranslationComplete(data) {
                console.log('ğŸ” mockHandleTranslationComplete - data type:', typeof data);
                console.log('ğŸ” mockHandleTranslationComplete - data:', data);
                
                // å¦‚æœdataæ˜¯å­—ç¬¦ä¸²ï¼Œå°è¯•è§£æä¸ºJSON
                if (typeof data === 'string') {
                    try {
                        const parsedData = JSON.parse(data);
                        console.log('ğŸ” mockHandleTranslationComplete - parsed data:', parsedData);
                        data = parsedData;
                    } catch (error) {
                        console.error('ğŸ” mockHandleTranslationComplete - JSON parse error:', error);
                        return `<div class="ai-translation-text">${data}</div>`;
                    }
                }
                
                let formattedContent = '';
                
                if (data.translation) {
                    formattedContent += `<div class="ai-section ai-translation-section">`;
                    formattedContent += `<div class="ai-section-title">ğŸ’¬ ç¿»è¯‘</div>`;
                    formattedContent += `<div class="ai-translation-content">${data.translation}</div>`;
                    formattedContent += `</div>`;
                }
                
                if (data.wordType) {
                    formattedContent += `<div class="ai-section ai-wordtype-section">`;
                    formattedContent += `<div class="ai-section-title">ğŸ“ è¯æ€§</div>`;
                    formattedContent += `<div class="ai-wordtype-content"><span class="ai-word-type-tag">${data.wordType}</span></div>`;
                    formattedContent += `</div>`;
                }
                
                if (data.pronunciation) {
                    formattedContent += `<div class="ai-section ai-pronunciation-section">`;
                    formattedContent += `<div class="ai-section-title">ğŸ”Š å‘éŸ³</div>`;
                    formattedContent += `<div class="ai-pronunciation-content">${data.pronunciation}</div>`;
                    formattedContent += `</div>`;
                }
                
                return formattedContent;
            }
            
            // æµ‹è¯•ç”¨ä¾‹1: ä¼ å…¥JSONå­—ç¬¦ä¸²
            const jsonString = `{
                "translation": "é›„è¾©çš„",
                "wordType": "å½¢å®¹è¯",
                "pronunciation": "/ËˆelÉ™kwÉ™nt/"
            }`;
            
            const result1 = mockHandleTranslationComplete(jsonString);
            
            // æµ‹è¯•ç”¨ä¾‹2: ä¼ å…¥å¯¹è±¡
            const jsonObject = {
                "translation": "é›„è¾©çš„",
                "wordType": "å½¢å®¹è¯",
                "pronunciation": "/ËˆelÉ™kwÉ™nt/"
            };
            
            const result2 = mockHandleTranslationComplete(jsonObject);
            
            document.getElementById('result2').innerHTML = `
                <strong>æµ‹è¯•ç”¨ä¾‹1 (JSONå­—ç¬¦ä¸²):</strong><br>
                ${result1}
                <br><br>
                <strong>æµ‹è¯•ç”¨ä¾‹2 (JSONå¯¹è±¡):</strong><br>
                ${result2}
            `;
        }
    </script>
</body>
</html>